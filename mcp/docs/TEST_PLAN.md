# geo-base MCPサーバー 動作確認テスト計画

**作成日**: 2025-12-14  
**対象**: geo-base MCP Server v0.2.5  
**環境**: リモートMCPサーバー（geo-base-remote）

---

## 1. セットアップ方法

### 1.1 前提条件

- Claude Desktop（macOS / Windows）がインストール済み
- インターネット接続が可能
- **uv**（Pythonパッケージマネージャー）がインストール済み

### 1.2 uvのインストール（未インストールの場合）

#### macOS / Linux

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Windows

```powershell
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"
```

インストール後、ターミナルを再起動してください。

### 1.3 uvxのパス確認

```bash
# macOS / Linux
which uvx
# 例: /Users/username/.local/bin/uvx

# Windows (PowerShell)
where uvx
# 例: C:\Users\username\.local\bin\uvx.exe
```

### 1.4 Claude Desktop設定

#### macOS

```bash
# 設定ファイルを開く
open ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

#### Windows

```powershell
# 設定ファイルを開く
notepad %APPDATA%\Claude\claude_desktop_config.json
```

### 1.5 設定内容

以下の内容を `claude_desktop_config.json` に追加または更新してください：

#### macOS

```json
{
  "mcpServers": {
    "geo-base-remote": {
      "command": "/Users/username/.local/bin/uvx",
      "args": [
        "mcp-proxy",
        "https://geo-base-mcp.fly.dev/sse",
        "--transport=sse"
      ]
    }
  }
}
```

> **重要**: `/Users/username/.local/bin/uvx` は実際の `which uvx` の結果に置き換えてください。

#### Windows

```json
{
  "mcpServers": {
    "geo-base-remote": {
      "command": "C:\\Users\\username\\.local\\bin\\uvx.exe",
      "args": [
        "mcp-proxy",
        "https://geo-base-mcp.fly.dev/sse",
        "--transport=sse"
      ]
    }
  }
}
```

> **重要**: パスは `where uvx` の結果に置き換え、バックスラッシュは `\\` でエスケープしてください。

### 1.6 仕組みの説明

Claude Desktopは**stdioトランスポートのみ**をネイティブサポートしています。リモートのSSEエンドポイントに接続するには、`mcp-proxy` を使用してSSE↔stdioの変換を行います。

```
Claude Desktop <--stdio--> mcp-proxy <--SSE--> geo-base-mcp.fly.dev
```

`uvx mcp-proxy` は初回実行時に自動的に `mcp-proxy` パッケージをダウンロード・実行します。

### 1.7 接続確認

1. Claude Desktopを再起動
2. 新しい会話を開始
3. 画面左下またはツールアイコンで「geo-base-remote」が表示されることを確認
4. 以下のプロンプトで接続テスト：

```
geo-baseサーバーの状態を確認して
```

**期待される結果**: サーバーのヘルスステータス（healthy）と各コンポーネントの状態が表示される

---

## 2. テスト計画概要

### 2.1 テストカテゴリ

| カテゴリ | ツール数 | 優先度 |
|---------|---------|--------|
| 基本接続確認 | 2 | 🔴 必須 |
| タイルセット操作 | 3 | 🔴 必須 |
| フィーチャー検索 | 2 | 🔴 必須 |
| ジオコーディング | 2 | 🔴 必須 |
| 統計ツール | 4 | 🟡 推奨 |
| 空間分析ツール | 4 | 🟡 推奨 |
| CRUD操作 | 6 | 🟢 オプション |

### 2.2 テスト所要時間

| テストレベル | 所要時間 | カバー範囲 |
|-------------|---------|-----------|
| クイックテスト | 5分 | 基本接続のみ |
| 標準テスト | 15分 | 必須カテゴリ |
| フルテスト | 30分 | 全カテゴリ |

---

## 3. テストケース

### 3.1 基本接続確認（必須）

#### Test 1.1: ヘルスチェック

**プロンプト**:
```
geo-baseサーバーの状態を確認して
```

**期待される結果**:
- status: "healthy"
- database: "connected"
- pmtiles: "available" または "unavailable"

**確認ポイント**: ✅ サーバーが応答すること

---

#### Test 1.2: サーバー情報取得

**プロンプト**:
```
geo-baseサーバーの設定情報を教えて
```

**期待される結果**:
- tile_server_url: "https://geo-base-api.fly.dev"
- mcp_server_name: "geo-base"
- environment: "production"

**確認ポイント**: ✅ 正しいURLとバージョンが表示されること

---

### 3.2 タイルセット操作（必須）

#### Test 2.1: タイルセット一覧取得

**プロンプト**:
```
利用可能なタイルセットを一覧表示して
```

**期待される結果**:
- タイルセットのリストが表示される
- 各タイルセットにID、名前、タイプが含まれる

**確認ポイント**: ✅ 少なくとも1つ以上のタイルセットが表示されること

---

#### Test 2.2: タイプ別フィルタリング

**プロンプト**:
```
ベクタータイルセットだけを表示して
```

**期待される結果**:
- type: "vector" のタイルセットのみ表示

**確認ポイント**: ✅ フィルタリングが正しく動作すること

---

#### Test 2.3: タイルセット詳細取得

**プロンプト**:
```
タイルセット一覧から1つ選んで、その詳細情報を教えて
```

**期待される結果**:
- タイルセットの詳細（bounds, zoom range, metadata等）が表示される

**確認ポイント**: ✅ 詳細情報が取得できること

---

### 3.3 フィーチャー検索（必須）

#### Test 3.1: 範囲検索（bbox）

**プロンプト**:
```
東京周辺（bbox: 139.5,35.5,140.0,36.0）のフィーチャーを10件取得して
```

**期待される結果**:
- 最大10件のフィーチャーが表示される
- 各フィーチャーにgeometry, propertiesが含まれる

**確認ポイント**: ✅ bbox検索が動作すること

---

#### Test 3.2: 件数制限

**プロンプト**:
```
フィーチャーを5件だけ取得して
```

**期待される結果**:
- 5件以下のフィーチャーが表示される

**確認ポイント**: ✅ limit パラメータが動作すること

---

### 3.4 ジオコーディング（必須）

#### Test 4.1: 住所→座標変換

**プロンプト**:
```
東京駅の座標を教えて
```

**期待される結果**:
- 緯度: 約35.68
- 経度: 約139.77
- 住所情報が含まれる

**確認ポイント**: ✅ ジオコーディングが動作すること

---

#### Test 4.2: 座標→住所変換

**プロンプト**:
```
緯度35.6812、経度139.7671の住所を教えて
```

**期待される結果**:
- 東京都千代田区付近の住所が表示される

**確認ポイント**: ✅ 逆ジオコーディングが動作すること

---

#### Test 4.3: 英語での検索

**プロンプト**:
```
Tokyo Towerの座標を調べて
```

**期待される結果**:
- 緯度: 約35.66
- 経度: 約139.75

**確認ポイント**: ✅ 英語クエリが動作すること

---

### 3.5 統計ツール（推奨）

#### Test 5.1: エリア統計

**プロンプト**:
```
bbox 139.7,35.6,139.8,35.7 のエリア統計を教えて
```

**期待される結果**:
- 面積（km²）
- フィーチャー数
- 密度（件/km²）

**確認ポイント**: ✅ 面積計算が正しいこと

---

#### Test 5.2: ジオメトリ分布

**プロンプト**:
```
フィーチャーのジオメトリタイプ分布を教えて
```

**期待される結果**:
- Point, LineString, Polygon等のカウント
- パーセンテージ

**確認ポイント**: ✅ 分布が計算されること

---

#### Test 5.3: タイルセット統計（タイルセットがある場合）

**プロンプト**:
```
タイルセット一覧を取得して、最初のタイルセットの統計情報を教えて
```

**期待される結果**:
- フィーチャー数
- ジオメトリタイプ分布
- レイヤー情報

**確認ポイント**: ✅ 統計が取得できること

---

### 3.6 空間分析ツール（推奨）

#### Test 6.1: 距離計算

**プロンプト**:
```
東京駅から渋谷駅までの直線距離を計算して
```

**期待される結果**:
- 距離: 約6-7km
- 方位: 南西方向

**確認ポイント**: ✅ 距離と方位が計算されること

---

#### Test 6.2: 2点間の距離（座標指定）

**プロンプト**:
```
(35.6812, 139.7671) から (35.6580, 139.7006) までの距離を計算して
```

**期待される結果**:
- 距離（km, m, miles）
- 方位角と方向

**確認ポイント**: ✅ 複数単位で表示されること

---

#### Test 6.3: 近傍検索

**プロンプト**:
```
東京駅から半径1km以内のフィーチャーを探して
```

**期待される結果**:
- 近い順にソートされたフィーチャーリスト
- 各フィーチャーの距離

**確認ポイント**: ✅ 距離順ソートが動作すること

---

#### Test 6.4: 空間分析（包括的）

**プロンプト**:
```
渋谷周辺（bbox: 139.69,35.65,139.72,35.67）の空間分析を実行して
```

**期待される結果**:
- 面積
- フィーチャー数・分布
- 密度分析結果
- クラスタリング結果（該当データがある場合）

**確認ポイント**: ✅ 複合分析が実行されること

---

#### Test 6.5: バッファゾーン分析

**プロンプト**:
```
東京駅から1km〜2kmの範囲（ドーナツ型）にあるフィーチャーを検索して
```

**期待される結果**:
- リング範囲内のフィーチャー
- リング面積
- 密度

**確認ポイント**: ✅ 内径・外径が正しく適用されること

---

### 3.7 CRUD操作（オプション・要認証）

> ⚠️ CRUD操作には `API_TOKEN` が必要です。リモートサーバーでは認証設定によっては実行できない場合があります。

#### Test 7.1: タイルセット作成

**プロンプト**:
```
'test-tileset-{日付}'という名前で新しいベクタータイルセットを作成して
```

**期待される結果**:
- 成功: 新しいタイルセットのID、名前が返される
- 失敗（認証なし）: 認証エラーメッセージ

**確認ポイント**: ✅ 作成または適切なエラーが返ること

---

#### Test 7.2: フィーチャー作成

**プロンプト**:
```
東京駅の位置にテストポイントを作成して。名前は'Test Point'
```

**期待される結果**:
- 成功: フィーチャーID、座標、プロパティが返される
- 失敗: 認証エラーまたはタイルセット未指定エラー

**確認ポイント**: ✅ 作成または適切なエラーが返ること

---

## 4. テストチェックリスト

### 4.1 クイックテスト（5分）

- [ ] Test 1.1: ヘルスチェック
- [ ] Test 2.1: タイルセット一覧
- [ ] Test 4.1: ジオコーディング（東京駅）

### 4.2 標準テスト（15分）

- [ ] Test 1.1 〜 1.2: 基本接続
- [ ] Test 2.1 〜 2.3: タイルセット操作
- [ ] Test 3.1 〜 3.2: フィーチャー検索
- [ ] Test 4.1 〜 4.3: ジオコーディング

### 4.3 フルテスト（30分）

- [ ] 標準テストの全項目
- [ ] Test 5.1 〜 5.3: 統計ツール
- [ ] Test 6.1 〜 6.5: 空間分析ツール
- [ ] Test 7.1 〜 7.2: CRUD操作（オプション）

---

## 5. トラブルシューティング

### 5.1 MCPサーバーが表示されない

**原因1**: 設定ファイルのJSON形式エラー

**解決方法**:
1. JSONの構文を確認（カンマ、括弧の対応）
2. [JSONLint](https://jsonlint.com/) などでバリデーション
3. Claude Desktopを完全に終了して再起動

**原因2**: uvxのパスが間違っている

**解決方法**:
1. `which uvx`（macOS/Linux）または `where uvx`（Windows）でパスを確認
2. 設定ファイルのパスを修正

### 5.2 mcp-proxyのエラー

**原因**: mcp-proxyが見つからない、または初回ダウンロードに失敗

**解決方法**:
```bash
# mcp-proxyを手動でインストール
uvx mcp-proxy --help

# それでも失敗する場合
uv tool install mcp-proxy
```

### 5.3 接続エラーが発生する

**原因**: ネットワーク問題またはサーバーダウン

**解決方法**:
1. インターネット接続を確認
2. ブラウザで `https://geo-base-mcp.fly.dev/health` にアクセスして確認
3. しばらく待ってから再試行

### 5.4 ツールが応答しない

**原因**: タイムアウトまたはサーバー負荷

**解決方法**:
1. より単純なクエリで再試行
2. bbox範囲を狭くして再試行

### 5.5 CRUD操作でエラー

**原因**: 認証トークン未設定

**解決方法**:
- リモートサーバーではCRUD操作に制限がある場合があります
- ローカル環境でのテストを推奨

### 5.6 「spawn uvx ENOENT」エラー（Windows）

**原因**: uvxへのパスが正しく設定されていない

**解決方法**:
1. フルパスを使用（例: `C:\\Users\\username\\.local\\bin\\uvx.exe`）
2. 環境変数PATHにuvxのディレクトリを追加

---

## 6. テスト結果記録

### テスト実施情報

| 項目 | 内容 |
|------|------|
| 実施日 | |
| 実施者 | |
| 環境 | Claude Desktop (Mac/Windows) |
| MCPサーバー | geo-base-remote |

### テスト結果サマリ

| カテゴリ | Pass | Fail | Skip | 備考 |
|---------|------|------|------|------|
| 基本接続 | /2 | | | |
| タイルセット | /3 | | | |
| フィーチャー | /2 | | | |
| ジオコーディング | /3 | | | |
| 統計 | /3 | | | |
| 空間分析 | /5 | | | |
| CRUD | /2 | | | |

### 発見した問題

| # | テストID | 問題内容 | 重要度 |
|---|---------|---------|--------|
| 1 | | | |
| 2 | | | |

---

## 7. 補足: ツール一覧クイックリファレンス

| ツール | 用途 | 認証 |
|--------|------|------|
| `tool_health_check` | サーバー状態確認 | 不要 |
| `tool_get_server_info` | サーバー情報取得 | 不要 |
| `tool_list_tilesets` | タイルセット一覧 | 不要 |
| `tool_get_tileset` | タイルセット詳細 | 不要 |
| `tool_get_tileset_tilejson` | TileJSON取得 | 不要 |
| `tool_search_features` | フィーチャー検索 | 不要 |
| `tool_get_feature` | フィーチャー詳細 | 不要 |
| `tool_geocode` | 住所→座標 | 不要 |
| `tool_reverse_geocode` | 座標→住所 | 不要 |
| `tool_get_tile_url` | タイルURL生成 | 不要 |
| `tool_get_tileset_stats` | タイルセット統計 | 不要 |
| `tool_get_feature_distribution` | ジオメトリ分布 | 不要 |
| `tool_get_layer_stats` | レイヤー統計 | 不要 |
| `tool_get_area_stats` | エリア統計 | 不要 |
| `tool_analyze_area` | 空間分析 | 不要 |
| `tool_calculate_distance` | 距離計算 | 不要 |
| `tool_find_nearest_features` | 近傍検索 | 不要 |
| `tool_get_buffer_zone_features` | バッファゾーン | 不要 |
| `tool_create_tileset` | タイルセット作成 | **必要** |
| `tool_update_tileset` | タイルセット更新 | **必要** |
| `tool_delete_tileset` | タイルセット削除 | **必要** |
| `tool_create_feature` | フィーチャー作成 | **必要** |
| `tool_update_feature` | フィーチャー更新 | **必要** |
| `tool_delete_feature` | フィーチャー削除 | **必要** |

---

**最終更新**: 2025-12-14
