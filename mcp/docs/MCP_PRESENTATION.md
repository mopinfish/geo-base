# geo-base MCPサーバー プレゼンテーション資料

## Claudeで地理空間データを操作する

**作成日**: 2025-12-14  
**最終更新**: 2025-12-14  
**対象**: geo-base MCP Server v0.2.5+  
**想定読者**: 技術者、プロダクトマネージャー、意思決定者

---

## 1. geo-base MCPサーバーとは

### 1.1 概要

geo-base MCPサーバーは、**Claude**を通じて地理空間データを検索・分析・操作できるようにするMCP（Model Context Protocol）サーバーです。

```
┌─────────────┐     MCP      ┌──────────────┐     HTTP     ┌─────────────┐
│   Claude    │ ◄──────────► │ geo-base MCP │ ◄──────────► │   API Server│
│  Desktop    │              │    Server    │              │   (Vercel)  │
└─────────────┘              └──────────────┘              └─────────────┘
                                                                  │
                                                                  ▼
                                                           ┌─────────────┐
                                                           │   PostGIS   │
                                                           │  (Supabase) │
                                                           └─────────────┘
```

### 1.2 できること

| カテゴリ | 機能 |
|---------|------|
| 🔍 **検索** | タイルセットやフィーチャーの検索、ジオコーディング |
| 📊 **分析** | 空間データの統計情報取得、密度分析、クラスタリング |
| 📏 **計算** | 距離計算、方位計算、近傍検索、バッファゾーン分析 |
| ✏️ **編集** | タイルセット・フィーチャーの作成・更新・削除 |
| 🗺️ **可視化** | タイルURLの生成、地図クライアントとの連携 |

---

## 2. ツール一覧

### 2.1 現在利用可能なツール（24個）

#### タイルセット関連（3ツール）

| ツール | 説明 |
|--------|------|
| `tool_list_tilesets` | タイルセット一覧を取得 |
| `tool_get_tileset` | タイルセット詳細を取得 |
| `tool_get_tileset_tilejson` | TileJSON（地図クライアント用メタデータ）を取得 |

#### フィーチャー関連（2ツール）

| ツール | 説明 |
|--------|------|
| `tool_search_features` | 範囲・レイヤー・属性でフィーチャーを検索 |
| `tool_get_feature` | フィーチャー詳細を取得 |

#### ジオコーディング（2ツール）

| ツール | 説明 |
|--------|------|
| `tool_geocode` | 住所・地名を座標に変換 |
| `tool_reverse_geocode` | 座標を住所に変換 |

#### CRUD操作（要認証）（6ツール）

| ツール | 説明 |
|--------|------|
| `tool_create_tileset` | 新しいタイルセットを作成 |
| `tool_update_tileset` | タイルセットを更新 |
| `tool_delete_tileset` | タイルセットを削除 |
| `tool_create_feature` | 新しいフィーチャーを作成 |
| `tool_update_feature` | フィーチャーを更新 |
| `tool_delete_feature` | フィーチャーを削除 |

#### 統計ツール（4ツール）🆕

| ツール | 説明 |
|--------|------|
| `tool_get_tileset_stats` | タイルセットの包括的統計情報を取得 |
| `tool_get_feature_distribution` | ジオメトリタイプの分布を取得 |
| `tool_get_layer_stats` | レイヤー別の統計情報を取得 |
| `tool_get_area_stats` | 指定エリアの統計情報を取得 |

#### 空間分析ツール（4ツール）🆕

| ツール | 説明 |
|--------|------|
| `tool_analyze_area` | 指定範囲の包括的空間分析（密度、クラスタリング） |
| `tool_calculate_distance` | 2点間の距離・方位を計算 |
| `tool_find_nearest_features` | 指定地点から近いフィーチャーを検索 |
| `tool_get_buffer_zone_features` | リングバッファ（ドーナツ型）内のフィーチャーを検索 |

#### ユーティリティ（3ツール）

| ツール | 説明 |
|--------|------|
| `tool_health_check` | サーバーの稼働状況を確認 |
| `tool_get_server_info` | サーバー設定情報を取得 |
| `tool_get_tile_url` | 特定タイルのURLを生成 |

---

## 3. ユースケース別デモシナリオ

### 3.1 基本操作：データ探索・検索

**シナリオ**: 東京周辺の地理データを探したい

**プロンプト例**:
```
ユーザー: 「東京周辺のデータを探して」

Claude: geo-base MCPを使って検索します...

[結果]
東京周辺（35.5°N〜35.9°N, 139.5°E〜140.0°E）で以下のフィーチャーが見つかりました：
- 建物データ: 1,250件
- 道路データ: 340件
- 公園データ: 85件
```

**実際に使えるプロンプト**:
- 「利用可能なタイルセットを一覧表示して」
- 「ベクタータイルセットだけ見せて」
- 「公開されているデータセットは何がある？」

---

### 3.2 ジオコーディング：住所⇔座標変換

**シナリオ**: 特定の住所の座標を知りたい

**プロンプト例**:
```
ユーザー: 「東京駅の座標を教えて」

Claude: ジオコーディングを実行します...

[結果]
東京駅
- 緯度: 35.6812
- 経度: 139.7671
- 住所: 東京都千代田区丸の内1丁目
```

**実際に使えるプロンプト**:
- 「渋谷駅の座標を調べて」
- 「'東京都港区六本木1-1-1'の緯度経度は？」
- 「Tokyo Towerをジオコーディングして」
- 「緯度35.6812、経度139.7671はどこ？」
- 「この座標 (139.7006, 35.6580) の住所を教えて」

---

### 3.3 距離計算：2地点間の距離と方角 🆕

**シナリオ**: 東京駅から渋谷駅までの距離を知りたい

**プロンプト例**:
```
ユーザー: 「東京駅から渋谷駅までの直線距離は？」

Claude: まず両地点の座標を取得し、距離を計算します...

[結果]
東京駅 → 渋谷駅
- 距離: 6.24 km
- 方位: 233.5°（南西）
- マイル換算: 3.88 miles
```

**実際に使えるプロンプト**:
- 「東京タワーからスカイツリーまでの距離を計算して」
- 「この2点間の距離は？(35.6812, 139.7671) と (35.6580, 139.7006)」
- 「新宿から横浜までどのくらい？」

---

### 3.4 近傍検索：周辺のフィーチャーを探す 🆕

**シナリオ**: 東京タワー周辺1km以内のポイントを探したい

**プロンプト例**:
```
ユーザー: 「東京タワーから半径1km以内のポイントを探して」

Claude: 東京タワーの座標を取得し、近傍検索を実行します...

[結果]
東京タワー（35.6586, 139.7454）から1km以内:
- 合計: 15件
- 最寄り: 増上寺（0.3km）
- 次点: 芝公園（0.5km）
```

**実際に使えるプロンプト**:
- 「渋谷駅から500m以内のPOIを検索」
- 「この座標の周辺2km以内のフィーチャーを5件取得して」
- 「新宿駅周辺のランドマークを近い順に表示」

---

### 3.5 空間分析：エリアの統計と密度分析 🆕

**シナリオ**: 新宿区内のフィーチャー密度を分析したい

**プロンプト例**:
```
ユーザー: 「新宿区内のデータ密度を分析して」

Claude: 空間分析を実行します...

[結果]
新宿区の分析結果：
- 面積: 18.22 km²
- フィーチャー数: 2,450件
- 密度: 134.5 件/km²
- ジオメトリ分布:
  - Point: 1,800件 (73.5%)
  - Polygon: 500件 (20.4%)
  - LineString: 150件 (6.1%)
- ホットスポット: 新宿駅周辺（密度最高）
- クラスター数: 5
```

**実際に使えるプロンプト**:
- 「bbox 139.5,35.5,140.0,36.0 内のフィーチャー分布を教えて」
- 「渋谷エリアの空間分析を実行」
- 「このbbox内のデータ密度とクラスタリング結果を見せて」

---

### 3.6 バッファゾーン分析：ドーナツ型の範囲検索 🆕

**シナリオ**: 東京駅から1-2km圏内（近すぎず遠すぎない範囲）のフィーチャーを探す

**プロンプト例**:
```
ユーザー: 「東京駅から1kmより遠く2km以内のフィーチャーを探して」

Claude: リングバッファ分析を実行します...

[結果]
東京駅から1-2km圏内（リングバッファ）:
- リング面積: 9.42 km²
- フィーチャー数: 234件
- 密度: 24.8 件/km²
- 含まれる主なエリア: 銀座、日本橋、八重洲
```

**実際に使えるプロンプト**:
- 「渋谷駅から500m-1kmの範囲にあるポイントを検索」
- 「この座標を中心に内径2km、外径5kmのドーナツ型範囲を分析」

---

### 3.7 統計情報：タイルセットとレイヤーの概要 🆕

**シナリオ**: タイルセットに含まれるデータの概要を知りたい

**プロンプト例**:
```
ユーザー: 「sample-vectorタイルセットの統計情報を教えて」

Claude: タイルセットの統計を取得します...

[結果]
sample-vector タイルセット統計:
- フィーチャー総数: 5,280件
- ジオメトリタイプ:
  - Point: 3,500件 (66.3%)
  - Polygon: 1,200件 (22.7%)
  - LineString: 580件 (11.0%)
- レイヤー数: 4
  - buildings: 1,200件
  - roads: 580件
  - poi: 3,000件
  - parks: 500件
- ズーム範囲: 0-14
```

**実際に使えるプロンプト**:
- 「このタイルセットに含まれるレイヤー別の統計を見せて」
- 「フィーチャーのジオメトリタイプ分布を教えて」
- 「指定エリア内のデータ量を概算して」

---

### 3.8 データ作成・更新：フィーチャーの編集

**シナリオ**: 新しいポイントデータを登録したい

**プロンプト例**:
```
ユーザー: 「渋谷駅の位置に'渋谷ランドマーク'というポイントを追加して」

Claude: フィーチャーを作成します...

[結果]
✅ フィーチャーを作成しました
- ID: abc12345-...
- 名前: 渋谷ランドマーク
- タイプ: Point
- 座標: [139.7006, 35.6580]
```

**実際に使えるプロンプト**:
- 「'my-points'という名前で新しいベクタータイルセットを作成して」
- 「東京駅の位置にポイントを追加して、名前は'Tokyo Station'」
- 「タイルセットID xxx の説明を更新して」
- 「フィーチャーID yyy を削除して」

---

## 4. サンプルプロンプト集

### 4.1 基本的な検索

```
# タイルセット一覧
「利用可能なタイルセットを一覧表示して」
「ベクタータイルセットだけ見せて」
「公開されているデータセットは何がある？」

# フィーチャー検索
「東京タワー周辺のデータを検索して」
「bbox 139.5,35.5,140.0,36.0 内のフィーチャーを取得」
「buildingsレイヤーのデータを100件取得して」
```

### 4.2 ジオコーディング

```
# 住所から座標
「渋谷駅の座標を調べて」
「'東京都港区六本木1-1-1'の緯度経度は？」
「Tokyo Towerをジオコーディングして」

# 座標から住所
「緯度35.6812、経度139.7671はどこ？」
「この座標 (139.7006, 35.6580) の住所を教えて」
```

### 4.3 距離・方位計算 🆕

```
「東京駅から渋谷駅までの直線距離は？」
「この2点間の距離と方角を計算して」
「新宿から横浜までどのくらい離れている？」
```

### 4.4 近傍・バッファ検索 🆕

```
「東京タワーから半径1km以内のポイントを探して」
「この座標の周辺500m以内のフィーチャーを検索」
「渋谷駅から1-2kmの範囲にあるPOIを表示」
```

### 4.5 空間分析・統計 🆕

```
「渋谷区内のデータ密度を分析して」
「このbbox内のフィーチャー分布を教えて」
「sample-vectorタイルセットの統計情報を見せて」
「指定エリア内のクラスタリング分析を実行して」
```

### 4.6 データ操作

```
# タイルセット作成
「'my-points'という名前で新しいベクタータイルセットを作成して」
「公開設定のタイルセットを作りたい」

# フィーチャー作成
「東京駅の位置にポイントを追加して、名前は'Tokyo Station'」
「以下のGeoJSONをフィーチャーとして登録して: {...}」

# 更新・削除
「タイルセットID xxx の説明を更新して」
「フィーチャーID yyy を削除して」
```

---

## 5. 技術的な詳細

### 5.1 接続方法

#### Claude Desktop（ローカル）

```json
// ~/Library/Application Support/Claude/claude_desktop_config.json
{
  "mcpServers": {
    "geo-base-local": {
      "command": "/Users/YOUR_USER/.local/bin/uv",
      "args": [
        "--directory",
        "/path/to/geo-base/mcp",
        "run",
        "server.py"
      ],
      "env": {
        "TILE_SERVER_URL": "https://geo-base-api.fly.dev"
      }
    }
  }
}
```

#### Claude Desktop（リモート SSE）

```json
{
  "mcpServers": {
    "geo-base-remote": {
      "url": "https://geo-base-mcp.fly.dev/sse"
    }
  }
}
```

### 5.2 認証

CRUD操作（作成・更新・削除）には `API_TOKEN` が必要です：

```bash
# 環境変数で設定
export API_TOKEN="your-supabase-jwt-token"
```

### 5.3 対応データ形式

| 形式 | 読み取り | 書き込み |
|------|---------|---------|
| GeoJSON | ✅ | ✅ |
| MVT (pbf) | ✅ | - |
| PMTiles | ✅ | - |
| PNG/JPEG/WebP | ✅ | - |

---

## 6. デモシナリオ

### 6.1 5分デモ: 基本機能紹介

```
1. サーバー確認（30秒）
   「geo-baseサーバーの状態を確認して」

2. データ探索（1分）
   「利用可能なタイルセットを一覧表示して」
   「sample-vectorの詳細を教えて」

3. ジオコーディング（1分）
   「東京駅の座標を調べて」
   「緯度35.6812、経度139.7671はどこ？」

4. フィーチャー検索（1分）
   「東京周辺のフィーチャーを10件取得して」

5. データ作成（1.5分）
   「新しいポイント'Demo Point'を東京駅の位置に作成して」
   「作成したフィーチャーを確認して」
```

### 6.2 10分デモ: 空間分析機能 🆕

```
1. 基本操作（2分）
   「サーバーの状態を確認」
   「タイルセット一覧を表示」

2. 距離計算（2分）
   「東京駅と渋谷駅の座標を取得して」
   「この2地点間の距離と方角を計算して」

3. 近傍検索（2分）
   「東京タワーから半径1km以内のポイントを探して」
   「近い順に5件表示して」

4. 空間分析（3分）
   「新宿エリア（bbox指定）の空間分析を実行」
   「密度とクラスタリング結果を教えて」

5. 統計確認（1分）
   「タイルセットの統計情報を表示」
```

### 6.3 15分デモ: 実践的なワークフロー

```
Phase 1: データ準備（3分）
- タイルセット一覧確認
- 新しいタイルセット作成
- タイルセット設定の更新

Phase 2: データ入力（4分）
- 複数のポイントを作成
- 属性情報を追加
- フィーチャーの更新

Phase 3: データ検索（3分）
- 範囲検索
- 属性フィルタリング
- ジオコーディング活用

Phase 4: 分析（5分）
- エリア分析
- 密度計算
- 近傍検索
- 統計レポート生成
```

---

## 7. よくある質問（FAQ）

### Q1: リアルタイムの位置情報は取得できますか？

**A**: 現時点では静的なジオコーディング（住所⇔座標変換）のみ対応しています。リアルタイム位置情報やナビゲーション機能は範囲外です。

### Q2: 大量のデータを一括でインポートできますか？

**A**: 現在は1件ずつの作成のみ対応しています。大量データのインポートにはAdmin UI（https://geo-base-admin.vercel.app）のGeoJSONインポート機能をご利用ください。

### Q3: 地図の可視化はできますか？

**A**: MCPサーバー自体は地図レンダリング機能を持ちませんが、`tool_get_tile_url` で生成したURLをMapLibre GL JSなどの地図ライブラリで利用できます。Admin UIでは視覚的なプレビューが可能です。

### Q4: 認証なしで使えるツールはありますか？

**A**: はい。検索系ツール（`tool_list_tilesets`、`tool_search_features`、`tool_geocode`など）と分析系ツール（`tool_analyze_area`、`tool_calculate_distance`など）は公開タイルセットに対して認証なしで使用できます。データの作成・更新・削除には `API_TOKEN` が必要です。

### Q5: どのような座標系に対応していますか？

**A**: WGS84（EPSG:4326）を標準としています。すべての座標は経度・緯度（度単位）で指定してください。

### Q6: 距離計算の精度は？

**A**: Haversine公式を使用した大圏距離計算を行っており、地球を球体と近似しています。一般的な用途には十分な精度ですが、測量レベルの精度が必要な場合は専用ツールをご利用ください。

---

## 8. システム情報

### 8.1 現在のバージョン

| コンポーネント | バージョン | URL |
|---------------|-----------|-----|
| MCP Server | 0.2.5 | https://geo-base-mcp.fly.dev |
| API Server | 0.4.0 | https://geo-base-api.fly.dev |
| Admin UI | - | https://geo-base-admin.vercel.app |

### 8.2 機能マトリックス

| 機能 | ステータス |
|------|-----------|
| タイルセット管理 | ✅ 完了 |
| フィーチャー管理 | ✅ 完了 |
| ジオコーディング | ✅ 完了 |
| CRUD操作 | ✅ 完了 |
| 統計ツール | ✅ 完了 |
| 空間分析ツール | ✅ 完了 |
| ロギング | ✅ 完了 |
| エラーハンドリング | ✅ 完了 |
| リトライ機能 | ✅ 完了 |
| 入力バリデーション | ✅ 完了 |
| テストカバレッジ85%+ | ✅ 完了 |

### 8.3 フィードバック

geo-base MCPサーバーへのフィードバックやご要望がありましたら、GitHubリポジトリのIssueでお知らせください。

- リポジトリ: https://github.com/mopinfish/geo-base
- Issues: https://github.com/mopinfish/geo-base/issues

---

## 付録: クイックリファレンス

### ツール早見表

| ツール | 認証 | 用途 |
|--------|------|------|
| `tool_list_tilesets` | 不要 | タイルセット一覧 |
| `tool_get_tileset` | 不要 | タイルセット詳細 |
| `tool_search_features` | 不要 | フィーチャー検索 |
| `tool_geocode` | 不要 | 住所→座標 |
| `tool_reverse_geocode` | 不要 | 座標→住所 |
| `tool_calculate_distance` | 不要 | 距離・方位計算 |
| `tool_find_nearest_features` | 不要 | 近傍検索 |
| `tool_get_buffer_zone_features` | 不要 | バッファゾーン分析 |
| `tool_analyze_area` | 不要 | 空間分析 |
| `tool_get_tileset_stats` | 不要 | タイルセット統計 |
| `tool_get_feature_distribution` | 不要 | ジオメトリ分布 |
| `tool_get_layer_stats` | 不要 | レイヤー別統計 |
| `tool_get_area_stats` | 不要 | エリア統計 |
| `tool_create_*` | **必要** | データ作成 |
| `tool_update_*` | **必要** | データ更新 |
| `tool_delete_*` | **必要** | データ削除 |

### 座標形式

```
# バウンディングボックス（bbox）
"minx,miny,maxx,maxy"
例: "139.5,35.5,140.0,36.0"

# ポイント座標（GeoJSON）
{"type": "Point", "coordinates": [経度, 緯度]}
例: {"type": "Point", "coordinates": [139.7671, 35.6812]}

# 座標の範囲
経度: -180 〜 180
緯度: -90 〜 90
```

---

**最終更新**: 2025-12-14
