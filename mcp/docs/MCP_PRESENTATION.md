# geo-base MCPサーバー プレゼンテーション資料

## Claudeで地理空間データを操作する

**作成日**: 2025-12-14  
**対象**: geo-base MCP Server v0.2.0+  
**想定読者**: 技術者、プロダクトマネージャー、意思決定者

---

## 1. geo-base MCPサーバーとは

### 1.1 概要

geo-base MCPサーバーは、**Claude**を通じて地理空間データを検索・分析・操作できるようにするMCP（Model Context Protocol）サーバーです。

```
┌─────────────┐     MCP      ┌──────────────┐     HTTP     ┌─────────────┐
│   Claude    │ ◄──────────► │ geo-base MCP │ ◄──────────► │   API Server│
│  Desktop    │              │    Server    │              │   (Vercel)  │
└─────────────┘              └──────────────┘              └─────────────┘
                                                                  │
                                                                  ▼
                                                           ┌─────────────┐
                                                           │   PostGIS   │
                                                           │  (Supabase) │
                                                           └─────────────┘
```

### 1.2 できること

| カテゴリ | 機能 |
|---------|------|
| 🔍 **検索** | タイルセットやフィーチャーの検索、ジオコーディング |
| 📊 **分析** | 空間データの統計情報取得、範囲分析（予定） |
| ✏️ **編集** | タイルセット・フィーチャーの作成・更新・削除 |
| 🗺️ **可視化** | タイルURLの生成、地図クライアントとの連携 |

---

## 2. ツール一覧

### 2.1 現在利用可能なツール（16個）

#### タイルセット関連

| ツール | 説明 |
|--------|------|
| `tool_list_tilesets` | タイルセット一覧を取得 |
| `tool_get_tileset` | タイルセット詳細を取得 |
| `tool_get_tileset_tilejson` | TileJSON（地図クライアント用メタデータ）を取得 |

#### フィーチャー関連

| ツール | 説明 |
|--------|------|
| `tool_search_features` | 範囲・レイヤー・属性でフィーチャーを検索 |
| `tool_get_feature` | フィーチャー詳細を取得 |

#### ジオコーディング

| ツール | 説明 |
|--------|------|
| `tool_geocode` | 住所・地名を座標に変換 |
| `tool_reverse_geocode` | 座標を住所に変換 |

#### CRUD操作（要認証）

| ツール | 説明 |
|--------|------|
| `tool_create_tileset` | 新しいタイルセットを作成 |
| `tool_update_tileset` | タイルセットを更新 |
| `tool_delete_tileset` | タイルセットを削除 |
| `tool_create_feature` | 新しいフィーチャーを作成 |
| `tool_update_feature` | フィーチャーを更新 |
| `tool_delete_feature` | フィーチャーを削除 |

#### ユーティリティ

| ツール | 説明 |
|--------|------|
| `tool_health_check` | サーバーの稼働状況を確認 |
| `tool_get_server_info` | サーバー設定情報を取得 |
| `tool_get_tile_url` | 特定タイルのURLを生成 |

### 2.2 今後追加予定のツール

| ツール | 説明 | 優先度 |
|--------|------|--------|
| `tool_analyze_area` | 指定範囲の空間分析 | ⭐最高 |
| `tool_get_system_stats` | システム全体の統計 | 高 |
| `tool_get_tileset_stats` | タイルセットの統計 | 高 |
| `tool_calculate_distance` | 2点間の距離計算 | 中 |
| `tool_find_nearby_features` | 近隣フィーチャー検索 | 中 |

---

## 3. ユースケース

### 3.1 データ探索・検索

**シナリオ**: 東京周辺の地理データを探したい

```
ユーザー: 「東京周辺のデータを探して」

Claude: geo-base MCPを使って検索します...

[結果]
東京周辺（35.5°N〜35.9°N, 139.5°E〜140.0°E）で以下のフィーチャーが見つかりました：
- 建物データ: 1,250件
- 道路データ: 340件
- 公園データ: 85件
```

### 3.2 住所から座標への変換

**シナリオ**: 特定の住所の座標を知りたい

```
ユーザー: 「東京駅の座標を教えて」

Claude: ジオコーディングを実行します...

[結果]
東京駅
- 緯度: 35.6812
- 経度: 139.7671
- 住所: 東京都千代田区丸の内1丁目
```

### 3.3 データの作成・更新

**シナリオ**: 新しいポイントデータを登録したい

```
ユーザー: 「渋谷駅の位置に'渋谷ランドマーク'というポイントを追加して」

Claude: フィーチャーを作成します...

[結果]
✅ フィーチャーを作成しました
- ID: abc12345-...
- 名前: 渋谷ランドマーク
- タイプ: Point
- 座標: [139.7006, 35.6580]
```

### 3.4 空間分析（予定）

**シナリオ**: 特定エリアのデータ密度を分析したい

```
ユーザー: 「新宿区内のフィーチャー密度を分析して」

Claude: 空間分析を実行します...

[結果]
新宿区の分析結果：
- 面積: 18.22 km²
- フィーチャー数: 2,450件
- 密度: 134.5 件/km²
- ジオメトリ分布:
  - Point: 1,800件 (73.5%)
  - Polygon: 500件 (20.4%)
  - LineString: 150件 (6.1%)
```

---

## 4. サンプルプロンプト集

### 4.1 基本的な検索

```
# タイルセット一覧
「利用可能なタイルセットを一覧表示して」
「ベクタータイルセットだけ見せて」
「公開されているデータセットは何がある？」

# フィーチャー検索
「東京タワー周辺のデータを検索して」
「bbox 139.5,35.5,140.0,36.0 内のフィーチャーを取得」
「buildingsレイヤーのデータを100件取得して」
```

### 4.2 ジオコーディング

```
# 住所から座標
「渋谷駅の座標を調べて」
「'東京都港区六本木1-1-1'の緯度経度は？」
「Tokyo Towerをジオコーディングして」

# 座標から住所
「緯度35.6812、経度139.7671はどこ？」
「この座標 (139.7006, 35.6580) の住所を教えて」
```

### 4.3 データ操作

```
# タイルセット作成
「'my-points'という名前で新しいベクタータイルセットを作成して」
「公開設定のタイルセットを作りたい」

# フィーチャー作成
「東京駅の位置にポイントを追加して、名前は'Tokyo Station'」
「以下のGeoJSONをフィーチャーとして登録して: {...}」

# 更新・削除
「タイルセットID xxx の説明を更新して」
「フィーチャーID yyy を削除して」
```

### 4.4 分析・統計（予定）

```
# 空間分析
「渋谷区内のデータ密度を分析して」
「このbbox内のフィーチャー分布を教えて」

# 距離計算
「東京駅から渋谷駅までの直線距離は？」
「この2点間の距離を計算して」

# 近隣検索
「東京タワーから半径1km以内のポイントを検索」
「この座標の近くにある施設を探して」
```

---

## 5. 技術的な詳細

### 5.1 接続方法

#### Claude Desktop（ローカル）

```json
// ~/Library/Application Support/Claude/claude_desktop_config.json
{
  "mcpServers": {
    "geo-base-local": {
      "command": "/Users/YOUR_USER/.local/bin/uv",
      "args": [
        "--directory",
        "/path/to/geo-base/mcp",
        "run",
        "server.py"
      ],
      "env": {
        "TILE_SERVER_URL": "https://geo-base-puce.vercel.app"
      }
    }
  }
}
```

#### Claude Desktop（リモート SSE）

```json
{
  "mcpServers": {
    "geo-base-remote": {
      "url": "https://geo-base-mcp.fly.dev/sse"
    }
  }
}
```

### 5.2 認証

CRUD操作（作成・更新・削除）には `API_TOKEN` が必要です：

```bash
# 環境変数で設定
export API_TOKEN="your-supabase-jwt-token"
```

### 5.3 対応データ形式

| 形式 | 読み取り | 書き込み |
|------|---------|---------|
| GeoJSON | ✅ | ✅ |
| MVT (pbf) | ✅ | - |
| PMTiles | ✅ | - |
| PNG/JPEG/WebP | ✅ | - |

---

## 6. デモシナリオ

### 6.1 5分デモ: 基本機能紹介

```
1. サーバー確認（30秒）
   「geo-baseサーバーの状態を確認して」

2. データ探索（1分）
   「利用可能なタイルセットを一覧表示して」
   「sample-vectorの詳細を教えて」

3. ジオコーディング（1分）
   「東京駅の座標を調べて」
   「緯度35.6812、経度139.7671はどこ？」

4. フィーチャー検索（1分）
   「東京周辺のフィーチャーを10件取得して」

5. データ作成（1.5分）
   「新しいポイント'Demo Point'を東京駅の位置に作成して」
   「作成したフィーチャーを確認して」
```

### 6.2 15分デモ: 実践的なワークフロー

```
Phase 1: データ準備（3分）
- タイルセット一覧確認
- 新しいタイルセット作成
- タイルセット設定の更新

Phase 2: データ入力（5分）
- 複数のポイントを作成
- 属性情報を追加
- フィーチャーの更新

Phase 3: データ検索（4分）
- 範囲検索
- 属性フィルタリング
- ジオコーディング活用

Phase 4: 分析（3分）※将来機能
- エリア分析
- 密度計算
- 統計レポート生成
```

---

## 7. よくある質問（FAQ）

### Q1: リアルタイムの位置情報は取得できますか？

**A**: 現時点では静的なジオコーディング（住所↔座標変換）のみ対応しています。リアルタイム位置情報やナビゲーション機能は範囲外です。

### Q2: 大量のデータを一括でインポートできますか？

**A**: 現在は1件ずつの作成のみ対応しています。セカンドシーズンで `tool_bulk_create_features` の追加を検討しています。

### Q3: 地図の可視化はできますか？

**A**: MCPサーバー自体は地図レンダリング機能を持ちませんが、`tool_get_tile_url` で生成したURLをMapLibre GL JSなどの地図ライブラリで利用できます。Admin UI（https://geo-base-admin.vercel.app）では視覚的なプレビューが可能です。

### Q4: 認証なしで使えるツールはありますか？

**A**: はい。検索系ツール（`tool_list_tilesets`、`tool_search_features`、`tool_geocode`など）は公開タイルセットに対して認証なしで使用できます。データの作成・更新・削除には `API_TOKEN` が必要です。

### Q5: どのような座標系に対応していますか？

**A**: WGS84（EPSG:4326）を標準としています。すべての座標は経度・緯度（度単位）で指定してください。

---

## 8. 次のステップ

### 8.1 セカンドシーズンの目標

1. **空間分析機能の実装**
   - `tool_analyze_area`: 範囲内のデータ分析
   - `tool_calculate_distance`: 距離計算
   - `tool_find_nearby_features`: 近隣検索

2. **保守性の向上**
   - 構造化ロギングの導入
   - エラーハンドリングの強化
   - リトライ処理の実装

3. **品質向上**
   - テストカバレッジ80%以上
   - 入力バリデーションの強化

### 8.2 フィードバック

geo-base MCPサーバーへのフィードバックやご要望がありましたら、GitHubリポジトリのIssueでお知らせください。

- リポジトリ: https://github.com/mopinfish/geo-base
- Issues: https://github.com/mopinfish/geo-base/issues

---

## 付録: クイックリファレンス

### ツール早見表

| ツール | 認証 | 用途 |
|--------|------|------|
| `tool_list_tilesets` | 不要 | タイルセット一覧 |
| `tool_get_tileset` | 不要 | タイルセット詳細 |
| `tool_search_features` | 不要 | フィーチャー検索 |
| `tool_geocode` | 不要 | 住所→座標 |
| `tool_reverse_geocode` | 不要 | 座標→住所 |
| `tool_create_*` | **必要** | データ作成 |
| `tool_update_*` | **必要** | データ更新 |
| `tool_delete_*` | **必要** | データ削除 |

### 座標形式

```
# バウンディングボックス（bbox）
"minx,miny,maxx,maxy"
例: "139.5,35.5,140.0,36.0"

# ポイント座標（GeoJSON）
{"type": "Point", "coordinates": [経度, 緯度]}
例: {"type": "Point", "coordinates": [139.7671, 35.6812]}

# 座標の範囲
経度: -180 〜 180
緯度: -90 〜 90
```

---

**最終更新**: 2025-12-14
